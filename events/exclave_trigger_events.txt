namespace = exclave_trigger

exclave_trigger.1 = { # check if an exclave that should be independent exists 4 times a year and call the game_rule event if there is
	hidden = yes

	immediate = {
		if = {
			limit = {
				is_independent_ruler = yes
				exists = root.capital_province
				any_sub_realm_title = {
					tier = tier_county
					NOT = {
						is_connected_to = {
							target = root.capital_province.county
						}
					}
				}
			}
			if = { # None
				limit = {
					has_game_rule = off_exclave_independence
				}
			}
			else_if = { # Limited, AI only
				limit = {
					has_game_rule = ai_limited_exclave_independence
					is_ai = yes
				}
				# Max naval distance for exclave independence
				if = {
					limit = { has_game_rule = default_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 2000
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 2000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = half_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 1000
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 1000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = quarter_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 500
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 500
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = eighth_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 250
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 250
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 175_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 175
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 175
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 100_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 100
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 100
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 0_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 0
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 0
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				
				while = {
					limit = {
						any_in_list = {
							list = cull_naval_connection_counties
						}
					}
					random_in_list = {
						list = cull_naval_connection_counties
						
						save_scope_as = cull_origin_county
						
						every_connected_county = {
							remove_from_list = cull_naval_connection_counties
							remove_from_list = disconnected_counties
						}
						remove_from_list = cull_naval_connection_counties
						remove_from_list = disconnected_counties
					}
				}
				
				every_in_list = {
					list = disconnected_counties
					
					limit = {
						target_is_de_jure_liege_or_above = root.primary_title
					}
					add_to_list = cull_de_jure_connection_counties
				}
				
				while = {
					limit = {
						any_in_list = {
							list = cull_de_jure_connection_counties
						}
					}
					random_in_list = {
						list = cull_de_jure_connection_counties
						
						save_scope_as = cull_origin_county
						
						every_connected_county = {
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
						remove_from_list = cull_de_jure_connection_counties
						remove_from_list = disconnected_counties
					}
				}
			}
			else_if = { # Significant, AI Only
				limit = {
					has_game_rule = ai_significant_exclave_independence
					is_ai = yes
					NOT = {
						any_vassal_or_below = {
							is_ai = no
						}
					}
				}
				# Max naval distance for exclave independence
				if = {
					limit = { has_game_rule = default_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 2000
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 2000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = half_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 1000
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 1000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = quarter_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 500
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 500
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = eighth_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 250
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 250
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 175_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 175
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 175
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 100_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 100
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 100
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 0_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 0
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 0
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				
				while = {
					limit = {
						any_in_list = {
							list = cull_naval_connection_counties
						}
					}
					random_in_list = {
						list = cull_naval_connection_counties
						
						save_scope_as = cull_origin_county
						
						every_connected_county = {
							remove_from_list = cull_naval_connection_counties
							remove_from_list = disconnected_counties
						}
						remove_from_list = cull_naval_connection_counties
						remove_from_list = disconnected_counties
					}
				}
			}
			else_if = { # Total, AI only
				limit = {
					has_game_rule = ai_total_exclave_independence
					is_ai = yes
					NOT = {
						any_vassal_or_below = {
							is_ai = no
						}
					}
				}
				# Max naval distance for exclave independence
				if = {
					limit = { has_game_rule = default_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 2000
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 2000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = half_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 1000
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 1000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = quarter_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 500
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 500
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = eighth_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 250
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 250
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 175_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 175
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 175
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 100_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 100
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 100
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 0_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 0
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 0
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				
				while = {
					limit = {
						any_in_list = {
							list = cull_naval_connection_counties
						}
					}
					random_in_list = {
						list = cull_naval_connection_counties
						
						save_scope_as = cull_origin_county
						
						every_connected_county = {
							remove_from_list = cull_naval_connection_counties
							remove_from_list = disconnected_counties
						}
						remove_from_list = cull_naval_connection_counties
						remove_from_list = disconnected_counties
					}
				}
			}
			else_if = { # Limited: Land connected to Capital, De Jure of Primary Title, or one gap away, as well as coastal
				limit = {
					has_game_rule = limited_exclave_independence
				}
				# Max naval distance for exclave independence
				if = {
					limit = { has_game_rule = default_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 2000
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 2000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = half_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 1000
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 1000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = quarter_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 500
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 500
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = eighth_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 250
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 250
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 175_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 175
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 175
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 100_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 100
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 100
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 0_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 0
							allow_one_county_land_gap = yes
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 0
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				
				while = {
					limit = {
						any_in_list = {
							list = cull_naval_connection_counties
						}
					}
					random_in_list = {
						list = cull_naval_connection_counties
						
						save_scope_as = cull_origin_county
						
						every_connected_county = {
							remove_from_list = cull_naval_connection_counties
							remove_from_list = disconnected_counties
						}
						remove_from_list = cull_naval_connection_counties
						remove_from_list = disconnected_counties
					}
				}
				
				every_in_list = {
					list = disconnected_counties
					
					limit = {
						target_is_de_jure_liege_or_above = root.primary_title
					}
					add_to_list = cull_de_jure_connection_counties
				}
				
				while = {
					limit = {
						any_in_list = {
							list = cull_de_jure_connection_counties
						}
					}
					random_in_list = {
						list = cull_de_jure_connection_counties
						
						save_scope_as = cull_origin_county
						
						every_connected_county = {
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
						remove_from_list = cull_de_jure_connection_counties
						remove_from_list = disconnected_counties
					}
				}
			}
			else_if = { # Significant: Land connected to Capital or De Jure of Primary Title, and coastal
				limit = {
					has_game_rule = significant_exclave_independence
				}
				# Max naval distance for exclave independence
				if = {
					limit = { has_game_rule = default_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 2000
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					while = {
						limit = {
							any_in_list = {
								list = disconnected_counties
								
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 2000
								}
							}
						}
						random_in_list = {
							list = disconnected_counties
							
							limit = {
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 2000
								}
							}
							
							remove_from_list = disconnected_counties
						}
					}
				}
				else_if = {
					limit = { has_game_rule = half_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 1000
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					while = {
						limit = {
							any_in_list = {
								list = disconnected_counties
								
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 1000
								}
							}
						}
						random_in_list = {
							list = disconnected_counties
							
							limit = {
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 1000
								}
							}
							
							remove_from_list = disconnected_counties
						}
					}
				}
				else_if = {
					limit = { has_game_rule = quarter_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 500
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					while = {
						limit = {
							any_in_list = {
								list = disconnected_counties
								
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 500
								}
							}
						}
						random_in_list = {
							list = disconnected_counties
							
							limit = {
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 500
								}
							}
							
							remove_from_list = disconnected_counties
						}
					}
				}
				else_if = {
					limit = { has_game_rule = eighth_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 250
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					while = {
						limit = {
							any_in_list = {
								list = disconnected_counties
								
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 250
								}
							}
						}
						random_in_list = {
							list = disconnected_counties
							
							limit = {
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 250
								}
							}
							
							remove_from_list = disconnected_counties
						}
					}
				}
				else_if = {
					limit = { has_game_rule = 175_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 175
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					while = {
						limit = {
							any_in_list = {
								list = disconnected_counties
								
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 175
								}
							}
						}
						random_in_list = {
							list = disconnected_counties
							
							limit = {
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 175
								}
							}
							
							remove_from_list = disconnected_counties
						}
					}
				}
				else_if = {
					limit = { has_game_rule = 100_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 100
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					while = {
						limit = {
							any_in_list = {
								list = disconnected_counties
								
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 100
								}
							}
						}
						random_in_list = {
							list = disconnected_counties
							
							limit = {
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 100
								}
							}
							
							remove_from_list = disconnected_counties
						}
					}
				}
				else_if = {
					limit = { has_game_rule = 0_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 0
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							target_is_de_jure_liege_or_above = root.primary_title
						}
						add_to_list = cull_de_jure_connection_counties
					}
					
					while = {
						limit = {
							any_in_list = {
								list = cull_de_jure_connection_counties
							}
						}
						random_in_list = {
							list = cull_de_jure_connection_counties
							
							save_scope_as = cull_origin_county
							
							every_connected_county = {
								remove_from_list = cull_de_jure_connection_counties
								remove_from_list = disconnected_counties
							}
							remove_from_list = cull_de_jure_connection_counties
							remove_from_list = disconnected_counties
						}
					}
					
					while = {
						limit = {
							any_in_list = {
								list = disconnected_counties
								
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 0
								}
							}
						}
						random_in_list = {
							list = disconnected_counties
							
							limit = {
								any_connected_county = {
									NOT = { is_in_list = disconnected_counties }
									max_naval_distance = 0
								}
							}
							
							remove_from_list = disconnected_counties
						}
					}
				}
			}
			else_if = { # Total: Only keep things connected to your capital, or coastal
				limit = {
					has_game_rule = total_exclave_independence
				}
				# Max naval distance for exclave independence
				if = {
					limit = { has_game_rule = default_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 2000
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 2000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = half_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 1000
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 1000
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = quarter_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 500
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 500
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = eighth_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 250
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 250
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 175_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 175
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 175
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 100_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected Counties
							invert = yes
							max_naval_distance = 100
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 100
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				else_if = {
					limit = { has_game_rule = 0_max_exclave_naval_distance }
					root.capital_province.county = {
						every_connected_county = { # Start off by making a list of all disconnected counties
							invert = yes
							max_naval_distance = 0
							add_to_list = disconnected_counties
						}
					}
					
					every_in_list = {
						list = disconnected_counties
						
						limit = {
							any_connected_county = {
								NOT = { is_in_list = disconnected_counties }
								max_naval_distance = 0
							}
						}
						add_to_list = cull_naval_connection_counties
					}
				}
				
				while = {
					limit = {
						any_in_list = {
							list = cull_naval_connection_counties
						}
					}
					random_in_list = {
						list = cull_naval_connection_counties
						
						save_scope_as = cull_origin_county
						
						every_connected_county = {
							remove_from_list = cull_naval_connection_counties
							remove_from_list = disconnected_counties
						}
						remove_from_list = cull_naval_connection_counties
						remove_from_list = disconnected_counties
					}
				}
			}

			if = {
				limit = {
					any_in_list = { list = disconnected_counties }
				}
				if = { #Create alerts for players
					limit = {
						AND = {
							is_ai = no
							NOT = { has_game_rule = immediate_exclave_independence_trigger }
						}
					}
					every_in_list = { #Add disconnected counties that aren't already in the list
						list = disconnected_counties
						limit = {
							NOT = {
								ROOT = {
									is_target_in_variable_list = {
										name = exclave_counties
										target = prev
									}
								}
							}
						}
						ROOT = {
							add_to_variable_list = {
								name = exclave_counties
								target = prev
							}
						}
						try_create_important_action = {
							important_action_type = action_exclave_independence_possible
							actor = root
							landed_title = this
						}
					}
				}
				if = {
					limit = { has_game_rule = default_exclave_independence_trigger }
				}
				else_if = {
					limit = { has_game_rule = 20_years_exclave_independence_trigger }
					trigger_event = {
						id = game_rule.2
						years = 20
					}
				}
				else_if = {
					limit = { has_game_rule = 10_years_exclave_independence_trigger }
					trigger_event = {
						id = game_rule.2
						years = 10
					}
				}
				else_if = {
					limit = { has_game_rule = 5_years_exclave_independence_trigger }
					trigger_event = {
						id = game_rule.2
						years = 5
					}
				}
				else_if = {
					limit = { has_game_rule = 1_year_exclave_independence_trigger }
					trigger_event = {
						id = game_rule.2
						years = 1
					}
				}
				else_if = {
					limit = { has_game_rule = immediate_exclave_independence_trigger }
					trigger_event = {
						id = game_rule.2
						days = 1
					}
				}
			}
		}
		every_in_list = { #Remove any counties that aren't disconnected anymore from the list
			variable = exclave_counties
			limit = {
				NOT = { is_in_list = disconnected_counties }
			}
			ROOT = {
				remove_list_variable = { 
					name = exclave_counties 
					target = prev
				}
			}
		}
	}
}